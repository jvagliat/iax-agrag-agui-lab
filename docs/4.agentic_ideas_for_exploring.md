# 6 Ideas de Sistemas Agénticos ADK para Explorar

> **Objetivo**: Ejemplos standalone que expongan el potencial de ADK sin dependencias complejas
>
> **Criterios**:
> - ✅ Sin bases de datos ni infraestructura compleja
> - ✅ Copy-paste ready en archivos independientes
> - ✅ Mock tools o APIs públicas simples
> - ✅ Desplegables directamente en servidor AGUI
> - ❌ No incluyen ADK Runner ni bajo nivel

---

## 0. Agentic RAG System ⭐
**Pattern**: Triage + Clarification Loop + Retrieval with Self-Reflection + Quality Gate

### Arquitectura

```
┌─────────────────────────────────────────────────────────────────┐
│                        USER QUERY                                │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   Triage Agent      │◄──── Analiza intent + historial
                    │   (Conversador)     │
                    └──────────┬──────────┘
                               │
                ┌──────────────┴──────────────┐
                │                             │
                ▼                             ▼
    ┌──────────────────────┐      ┌─────────────────────────┐
    │ Respuesta Directa    │      │   Clarifier Agent       │
    │ (secretaria/general) │      │   (Refinement Loop)     │
    └──────────────────────┘      └──────────┬──────────────┘
                                              │
                                    ┌─────────┴─────────┐
                                    │ ¿Suficientemente  │
                                    │   específico?     │
                                    └─────────┬─────────┘
                                              │
                                   NO ◄───────┼───────► SÍ
                                   │          │         │
                                   ▼          │         ▼
                        ┌──────────────────┐  │  ┌──────────────────────────┐
                        │ Pide detalles    │  │  │ Retrieval Strategist     │
                        │ al usuario       │  │  │ ┌──────────────────────┐ │
                        └────────┬─────────┘  │  │ │ 1. Planea queries    │ │
                                 │            │  │ │ 2. Ejecuta búsquedas │ │
                                 └────────────┘  │ │ 3. Auto-evalúa       │ │
                                                 │ └──────────┬───────────┘ │
                                                 └────────────┼─────────────┘
                                                              │
                                                   ┌──────────┴─────────┐
                                                   │ ¿Chunks suficientes│
                                                   │   y relevantes?    │
                                                   └──────────┬─────────┘
                                                              │
                                                   NO ◄───────┼───────► SÍ
                                                   │          │         │
                                                   ▼          │         ▼
                                        ┌──────────────────┐  │  ┌──────────────────┐
                                        │ Re-query con     │  │  │   Synthesizer    │
                                        │ nueva estrategia │  │  │   (Redactor)     │
                                        └────────┬─────────┘  │  └────────┬─────────┘
                                                 │            │           │
                                                 └────────────┘           ▼
                                                              ┌──────────────────────┐
                                                              │   Quality Gate       │
                                                              │   (Validador)        │
                                                              └──────────┬───────────┘
                                                                         │
                                                              ┌──────────┴─────────┐
                                                              │ ¿Coherente,        │
                                                              │ completo, citado?  │
                                                              └──────────┬─────────┘
                                                                         │
                                                              FAIL ◄─────┼─────► PASS
                                                              │          │       │
                                                              ▼          │       ▼
                                                   ┌────────────────┐    │  ┌──────────┐
                                                   │ Rebotar a:     │    │  │ RESPUESTA│
                                                   │ - Retrieval o  │    │  │  FINAL   │
                                                   │ - Synthesizer  │    │  └──────────┘
                                                   └────────┬───────┘    │
                                                            │            │
                                                            └────────────┘
```

### Diagrama de Agentes y Comunicación

```
                                USER QUERY
                                    ↓
                ┌───────────────────────────────────────┐
                │     1️⃣ TRIAGE AGENT                  │
                │     (Conversador/Router)              │
                │                                       │
                │  Tools:                               │
                │  • analyze_conversation_history()     │
                │  • transfer_to_clarifier()            │
                │  • answer_directly()                  │
                └───────────────┬───────────────────────┘
                                │
                    ┌───────────┴──────────┐
                    ↓                      ↓
            [GENERAL Query]        [SPECIFIC Query]
                    ↓                      ↓
            Direct Answer      ┌───────────────────────────┐
                               │  2️⃣ CLARIFIER AGENT       │
                               │  (Refinement Loop)        │
                               │                           │
                               │  Tools:                   │
                               │  • ask_user_for_details() │
                               │  • extract_keywords()     │
                               │  • transfer_to_retrieval()│
                               └──────────┬────────────────┘
                                          │
                                   [ready: false]──┐
                                          │        │
                                   [ready: true]   │
                                          ↓        │
                               ┌──────────────────┐│
                               │ Ask User Details ││
                               └──────────────────┘│
                                          ↑        │
                                          └────────┘
                                          │
                                   [ready: true]
                                          ↓
                      ┌────────────────────────────────────┐
                      │  3️⃣ RETRIEVAL STRATEGIST          │
                      │  (Planner + Executor + Evaluator) │
                      │                                    │
                      │  Tools:                            │
                      │  • vector_search()                 │
                      │  • expand_query()                  │
                      │  • score_chunk_relevance()         │
                      │  • transfer_to_synthesizer()       │
                      └────────────┬───────────────────────┘
                                   │
                         [Self-Reflection]
                                   │
                    ┌──────────────┴────────────────┐
                    ↓                               ↓
            [quality_score < 70]          [quality_score ≥ 70]
                    ↓                               ↓
            ┌──────────────┐               ┌───────────────────┐
            │ Re-query con │               │ 4️⃣ SYNTHESIZER    │
            │ nueva estrat.│               │ (Redactor)        │
            └──────┬───────┘               │                   │
                   │                       │ Tools:            │
                   │                       │ • format_citations│
                   └───────────────────────│ • structure_resp. │
                                           │ • transfer_to_QG()│
                                           └─────────┬─────────┘
                                                     │
                                                     ↓
                                  ┌──────────────────────────────┐
                                  │  5️⃣ QUALITY GATE AGENT       │
                                  │  (Validador)                 │
                                  │                              │
                                  │  Tools:                      │
                                  │  • verify_citations()        │
                                  │  • check_completeness()      │
                                  │  • transfer_to_retrieval()   │
                                  │  • transfer_to_synthesizer() │
                                  └────────────┬─────────────────┘
                                               │
                                    [Validation Decision]
                                               │
                        ┌──────────────────────┼──────────────────────┐
                        ↓                      ↓                      ↓
                [approved: true]    [feedback: retrieval]  [feedback: synthesis]
                        ↓                      ↓                      ↓
                  ┌──────────┐          ┌──────────┐          ┌──────────┐
                  │ RESPUESTA│          │ Back to  │          │ Back to  │
                  │  FINAL   │          │ Agent 3️⃣ │          │ Agent 4️⃣ │
                  └──────────┘          └──────────┘          └──────────┘

SHARED STATE (accesible por todos):
├─ conversation_history
├─ original_user_query
├─ refined_query
├─ retrieved_chunks
└─ metadata (queries_used, scores, attempts)
```

---

### Agentes del Sistema

#### 1️⃣ **Triage Agent** (Conversador/Router)
**Rol**: Punto de entrada del sistema, clasifica el tipo de consulta

**Prompt simplificado**:
```
Eres un asistente que clasifica consultas de usuarios.

Analiza la pregunta y el historial de conversación para determinar:
- GENERAL: Preguntas simples, saludos, aclaraciones de contexto
- SPECIFIC: Requiere búsqueda en documentación técnica

Retorna JSON: {"type": "GENERAL|SPECIFIC", "reason": "..."}
```

**Tools**:
- `analyze_conversation_history()` - Lee historial compartido
- `transfer_to_clarifier()` - Delega a Clarifier si es SPECIFIC
- `answer_directly()` - Responde si es GENERAL

---

#### 2️⃣ **Clarifier Agent** (Refinamiento de Query)
**Rol**: Asegura que la pregunta sea suficientemente específica antes de buscar

**Prompt simplificado**:
```
Eres un asistente que refina preguntas ambiguas.

Evalúa si la pregunta tiene suficiente contexto para buscar en docs:
- ¿Qué tema/módulo específico?
- ¿Qué versión/contexto técnico?
- ¿Qué tipo de respuesta busca? (conceptual, código, troubleshooting)

Si falta información, pregunta al usuario.
Si está clara, extrae keywords y contexto para búsqueda.

Retorna JSON: {"ready": true/false, "missing_info": "...", "search_context": {...}}
```

**Tools**:
- `ask_user_for_details(question)` - Solicita aclaraciones
- `extract_search_keywords(query)` - Extrae términos clave
- `transfer_to_retrieval()` - Delega a Retrieval cuando está listo

**Loop**: Puede iterar pidiendo detalles hasta tener query específica

---

#### 3️⃣ **Retrieval Strategist** (Planificador y Ejecutor de Búsquedas)
**Rol**: Diseña estrategia de búsqueda, ejecuta queries vectoriales, auto-evalúa resultados

**Prompt simplificado**:
```
Eres un experto en recuperación de información.

1. PLANIFICACIÓN: Descompón la pregunta en sub-queries necesarias
2. EJECUCIÓN: Busca en vector DB con diferentes estrategias:
   - Búsqueda semántica directa
   - Expansión de términos
   - Búsqueda por sinónimos/conceptos relacionados
3. AUTO-EVALUACIÓN: Analiza si los chunks recuperados:
   - Son relevantes a la pregunta
   - Tienen suficiente información
   - No son contradictorios

Retorna JSON: {
  "queries_executed": [...],
  "chunks_found": [...],
  "quality_score": 0-100,
  "needs_requery": true/false,
  "requery_strategy": "..."
}
```

**Tools**:
- `vector_search(query, top_k)` - Búsqueda en vector DB
- `expand_query(original_query)` - Genera variaciones
- `score_chunk_relevance(chunk, query)` - Evalúa relevancia
- `transfer_to_synthesizer()` - Delega cuando tiene info suficiente

**Self-Reflection**: Si `quality_score < 70`, re-ejecuta con nueva estrategia

---

#### 4️⃣ **Synthesizer Agent** (Redactor)
**Rol**: Genera respuesta final citando fuentes

**Prompt simplificado**:
```
Eres un redactor técnico experto.

Usando los chunks recuperados, genera una respuesta que:
1. Responda directamente la pregunta del usuario
2. Cite las fuentes con formato [Doc X, línea Y]
3. Use lenguaje claro y estructurado
4. Indique si la información es parcial o completa

Formato de salida:
- Respuesta principal
- Sección "Fuentes consultadas"
- Advertencias/limitaciones si aplica
```

**Tools**:
- `format_citations(chunks)` - Genera referencias
- `structure_response(content)` - Da formato profesional
- `transfer_to_quality_gate()` - Envía a validación

---

#### 5️⃣ **Quality Gate Agent** (Validador)
**Rol**: Valida coherencia, completitud y calidad de la respuesta final

**Prompt simplificado**:
```
Eres un revisor de calidad de respuestas técnicas.

Evalúa la respuesta según criterios:
1. COHERENCIA: ¿La respuesta tiene sentido lógico?
2. COMPLETITUD: ¿Responde toda la pregunta original?
3. CITATIONS: ¿Todas las afirmaciones están citadas?
4. ACCURACY: ¿Los chunks citados realmente soportan lo dicho?

Retorna JSON: {
  "approved": true/false,
  "issues": [...],
  "feedback_for": "retrieval|synthesis",
  "suggested_fix": "..."
}
```

**Tools**:
- `verify_citations(response, chunks)` - Valida referencias
- `check_completeness(response, original_query)` - Verifica cobertura
- `transfer_to_retrieval()` - Rebotar si faltan chunks
- `transfer_to_synthesizer()` - Rebotar si es problema de redacción

**Decision Tree**:
- `approved: true` → Retorna respuesta final
- `feedback_for: "retrieval"` → Vuelve a Retrieval Strategist
- `feedback_for: "synthesis"` → Vuelve a Synthesizer

---

### Técnicas LLM
- **Intent classification** en Triage
- **Conversational refinement** en Clarifier
- **Query decomposition** en Retrieval Strategist
- **Self-reflection** para evaluar calidad de chunks
- **Citation-aware synthesis** en Redactor
- **Multi-criteria validation** en Quality Gate

### Tools Globales (Mock)
- Vector DB search (mock con embeddings)
- Relevance scorer
- Query expander
- Citation extractor
- Coherence validator

### Mejoras vs RAG tradicional
- ✅ **Triage inteligente**: No todo va a RAG, preguntas simples se responden directo
- ✅ **Clarification loop**: Evita retrievals inútiles por queries ambiguas
- ✅ **Self-reflection**: El agente evalúa si necesita más contexto antes de redactar
- ✅ **Quality feedback loop**: Puede reintentar retrieval o síntesis si falla validación
- ✅ **Shared state**: Historial conversacional informa todas las decisiones

### Complejidad: Alta
**Output esperado**: Respuesta documentada con citations + metadata de retrieval (queries usadas, chunks relevantes, confidence score)

---

## 1. Research Paper Analyzer
**Pattern**: Coordinator + Specialist

### Arquitectura
```
Coordinator Agent
├── Methodology Critic (analiza rigor metodológico)
├── Results Interpreter (extrae hallazgos clave)
├── Literature Contextualizador (sitúa el paper en su campo)
└── Synthesizer Agent (agrega análisis y genera reporte)
```

### Técnicas LLM
- **Few-shot prompting** para cada especialista
- **Chain-of-thought** en análisis crítico
- **Summarization avanzada** en síntesis final

### Tools
- Text extraction
- Citation parser
- Keyword analyzer

### Complejidad: Media
**Output esperado**: Reporte multi-dimensional de análisis académico

---

## 2. Code Review & Refactor Assistant
**Pattern**: Sequential + Iterative (LoopAgent)

### Arquitectura
```
Sequential Pipeline:
1. Security Auditor → detecta vulnerabilidades
2. Performance Analyzer → identifica cuellos de botella
3. Best Practices Reviewer → valida patrones
4. Refactoring Agent → propone cambios específicos
5. Quality Gate (Loop) → evalúa si cumple umbrales
```

### Técnicas LLM
- **Role-based prompting** (cada agente con rol experto)
- **Self-consistency** en detección de issues
- **Reflection pattern** en quality gate

### Tools
- Code parser
- AST analyzer
- Metrics calculator
- Linting validator

### Complejidad: Media-Alta
**Output esperado**: Análisis completo + refactorización sugerida con métricas

---

## 3. Travel Planner
**Pattern**: Parallel Fan-Out + Human-in-the-Loop

### Arquitectura
```
Master Planner
├── (Parallel) Flight Searcher
├── (Parallel) Hotel Finder
├── (Parallel) Activity Curator
└── Budget Optimizer (agrega resultados)
    └── Human Approval Gate ⏸️
```

### Técnicas LLM
- **Constraint-based prompting** para presupuesto
- **Preference learning** de conversación
- **Multi-criteria ranking**

### Tools
- Mock flight API
- Hotel search (mock)
- Weather API (pública)
- Budget calculator

### Complejidad: Alta
**Output esperado**: Plan de viaje completo optimizado esperando aprobación humana

---

## 4. Debate & Consensus Builder
**Pattern**: Adversarial + Synthesis

### Arquitectura
```
Moderator (orquestador)
├── Proposition Agent (argumenta a favor)
├── Opposition Agent (argumenta en contra)
├── Fact Checker (valida claims)
└── Mediator (busca consenso)

Shared State: Historial de argumentos + facts verificados
```

### Técnicas LLM
- **Adversarial prompting**
- **Socratic questioning** en moderador
- **Logical reasoning** en fact checker
- **Dialectical synthesis**

### Tools
- Fact verification (mock)
- Argument structure analyzer
- Contradiction detector
- Logical fallacy identifier

### Complejidad: Media
**Output esperado**: Debate estructurado + puntos de consenso encontrados

---

## 5. Adaptive Learning Tutor
**Pattern**: Hierarchical + Adaptive (LoopAgent)

### Arquitectura
```
Assessment Agent
└── Curriculum Designer
    ├── Explainer Agent (enseña conceptos)
    ├── Quiz Generator (ejercicios adaptativos)
    └── Performance Tracker (ajusta dificultad)
        └── LoopAgent (itera hasta dominio)
```

### Técnicas LLM
- **Adaptive prompting** según nivel estudiante
- **Analogical reasoning** para explicaciones
- **Scaffolding incremental**
- **Meta-learning** (aprender cómo aprende el usuario)

### Tools
- Difficulty scorer
- Example generator
- Progress tracker
- Knowledge graph builder (simple)

### Complejidad: Alta
**Output esperado**: Sesión educativa personalizada con progreso medible

---


## 📊 Resumen Comparativo

| Ejemplo | Multi-Agent Pattern | Técnicas LLM Clave | Tools | Complejidad |
|---------|--------------------|--------------------|-------|-------------|
| **Agentic RAG** ⭐ | Triage + Loop + Self-Reflection + Gate | Intent classification, Query decomposition, Self-reflection | 4-5 | Alta |
| **Paper Analyzer** | Coordinator + Specialists | Few-shot, CoT, Summarization | 3-4 | Media |
| **Code Review** | Sequential + Iterative | Role-based, Self-consistency, Reflection | 4-5 | Media-Alta |
| **Travel Planner** | Parallel + Human-in-Loop | Constraint-based, Preference learning | 5-6 | Alta |
| **Debate System** | Adversarial + Synthesis | Socratic, Dialectical, Logical reasoning | 3-4 | Media |
| **Learning Tutor** | Hierarchical + Adaptive | Adaptive, Scaffolding, Meta-learning | 4-5 | Alta |

---

## 🎯 Cobertura de Capacidades ADK

### Patrones Multi-Agénticos
- ✅ Coordinator/Dispatcher
- ✅ Sequential Pipeline
- ✅ Parallel Fan-Out/Gather
- ✅ Hierarchical Task Decomposition
- ✅ Review/Critique (iterative)
- ✅ Human-in-the-Loop
- ✅ Adversarial/Debate
- ✅ Adaptive/Loop

### Técnicas de Prompting Avanzadas
- ✅ Few-shot prompting
- ✅ Chain-of-thought (CoT)
- ✅ Role-based prompting
- ✅ Self-consistency
- ✅ Reflection
- ✅ Constraint-based
- ✅ Adversarial
- ✅ Socratic questioning
- ✅ Dialectical synthesis
- ✅ Adaptive prompting
- ✅ Scaffolding
- ✅ Meta-learning

### Mecanismos de Comunicación
- ✅ Shared Session State
- ✅ LLM-Driven Delegation (`transfer_to_agent()`)
- ✅ Explicit Invocation (AgentTool)

---

## 🚀 Próximos Pasos

1. **Seleccionar** 1-2 ejemplos para desarrollo inicial
2. **Implementar** cada ejemplo en archivo standalone
3. **Probar** despliegue en servidor AGUI
4. **Iterar** según eventos/datos emitidos observados

---

## 📝 Notas de Implementación

- **No usar**: ADK Runner, deployment configs, containerization
- **Usar**: Solo definición de agentes, tools, prompts
- **Formato**: Python standalone compatible con servidor AGUI
- **Testing**: Mock data para demostración inmediata
