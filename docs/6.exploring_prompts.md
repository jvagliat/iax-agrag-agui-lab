# Exploración de Prompts y Agentes

Este documento identifica los agentes definidos en el proyecto, extrae sus prompts (incluyendo descripciones indirectas como las de herramientas) y realiza un análisis breve de cada uno.

Fuentes principales exploradas en `src/iax_agrag_agui_lab/agents/**`:
- `agents/hello_agent.py`
- `agents/web_search_agent.py`
- `agents/agrag/agentic_rag.py`
- `agents/agrag/agentic_rag_multi_query.py`
- `agents/agrag/workana_rag_agent.py`
- `agents/coordinator_agent.py`
- `agents/pizza_agent.py`
- Herramientas: `agents/tools/tavily_search_tool.py`, `agents/agrag/query_iax_docs_tool.py`, `agents/agrag/query_workana_docs_tool.py`


## 1) Agentes identificados

- Hello Agent (`hello_agent`)
- Web Search Agent (`web_search_agent`)
- Coordinator (`coordinator`) y sub‑agente `platform_specialist`
- Agentic RAG (simple): `triage_agent`, `retrieval_agent`, `synthesizer_agent`, `retrieval_pipeline`, `agentic_rag_bot`
- Agentic RAG (multi‑query): `triage_agent`, `query_generator_agent`, `multi_retrieval_agent`, `synthesizer_agent`, `research_pipeline`, `agentic_rag_multi_query_bot`
- Workana RAG: `triage_agent`, `question_generator`, `search_query_generator`, `multi_retrieval_agent`, `synthesizer_agent`, `workana_rag_bot`
- Pizzería (demo multi‑agente): `chef`, `delivery`, `kitchen_pipeline`, `cajero`, `pizzeria_bot`


## 2) Prompts extraídos (directos e indirectos)

A continuación se listan por agente/herramienta. Se incluyen `description`, `instruction` y, cuando aplica, descripciones de herramientas utilizadas como parte del contexto del agente. Nota: algunos textos presentan artefactos de codificación (acentos y símbolos) tal como están en el código fuente.


### Hello Agent (src/iax_agrag_agui_lab/agents/hello_agent.py)
- description: "Has friendly chats with a user."
- instruction:
  """
  You are a helpful assistant, chatting with a user. 
  Be polite and friendly, introducing yourself and asking who the user is. 

  If the user provides their name, use the 'say_hello' tool to get a custom greeting.
  If the tool returns an error, inform the user politely. 
  If the tool is successful, present the reply.
  """
- tool `say_hello(person_name: str) -> dict` (docstring):
  """
  Formats a welcome message to a named person. 

  Args:
      person_name (str): the name of the person saying hello

  Returns:
      dict: A dictionary containing the results of the query.
            Includes a 'status' key ('success' or 'error').
            If 'success', includes a 'query_result' key with an array of result rows.
            If 'error', includes an 'error_message' key.
  """


### Web Search Agent (src/iax_agrag_agui_lab/agents/web_search_agent.py)
- description: "Agent to answer questions using TavilySearch."
- instruction: "I can answer your questions by searching the internet. Just ask me anything!"
- tool `create_adk_tavily_search_tool` (docstring en wrapper):
  """
  Creates a Tavily search tool wrapped in a LangchainTool for ADK.

  Returns:
      LangchainTool: The Tavily search tool wrapped for ADK.
  """
  Nota: el wrapper usa `langchain_community.tools.TavilySearchResults`, cuya descripción interna no está expuesta en el código del repo.


### Agentic RAG (simple) (src/iax_agrag_agui_lab/agents/agrag/agentic_rag.py)
- TriageAgent
  - description: "Clasifica consultas del usuario: GENERAL o SPECIFIC"
  - instruction (fragmento):
    """
    Eres un asistente que clasifica consultas de usuarios.

    Analiza la pregunta del usuario y determina:

    - **GENERAL**: Saludos, preguntas simples, conversaciA3n casual
      Ejemplos: "hola", "A�cA3mo estÁs?", "gracias", "A�quAc puedes hacer?"

    - **SPECIFIC**: Preguntas especificas sobre la empresa, iattraxia o sus servicios, 
    o aspectos relacionados con la plataforma IAX, desarrollo de software, IA, Agentes o automatizaciones. 

    **Si es GENERAL**: Responde directamente de forma amigable y breve.

    **Si es SPECIFIC**: Di algo como "DAcjame buscar esa informaciA3n para ti..."
    y luego USA la herramienta transfer_to_agent para llamar a 'RetrievalAgent'.

    SAc conversacional y amigable en tu respuesta.
    """
- RetrievalAgent
  - description: "Busca informaciA3n relevante en la base de conocimiento"
  - instruction (fragmento):
    """
    Eres un experto en recuperaciA3n de informaciA3n.

    El usuario preguntA3: (lee el mensaje del usuario)

    **Tu trabajo**:
    1. Identifica las palabras clave principales de la pregunta
    2. USA la herramienta `vector_search` con esas keywords
    3. EvalÁa si los resultados son relevantes
    4. Si los chunks son buenos, transfiere a 'SynthesizerAgent' con transfer_to_agent
    5. Si no encuentras nada Átil, dáselo al usuario educadamente

    **Importante**: Siempre usa la herramienta vector_search antes de decidir.
    """
- SynthesizerAgent
  - description: "Redacta respuesta final citando fuentes"
  - instruction (fragmento):
    """
    Eres un redactor técnico experto.

    El usuario preguntó: (lee el mensaje original del usuario)
    Los chunks recuperados están en: {retrieved_chunks?}

    **Tu trabajo**:
    1. Lee cuidadosamente los chunks recuperados
    2. Genera una respuesta clara y estructurada que responda la pregunta
    3. CITA las fuentes al final: "Fuentes: [fuente1], [fuente2]"
    4. Si la información es parcial, indácalo
    5. Usa un tono profesional pero amigable

    """
- tool `vector_search_tool` → `query_iax_documentation_rag` (ver docstring de herramienta más abajo)


### Agentic RAG (multi‑query) (src/iax_agrag_agui_lab/agents/agrag/agentic_rag_multi_query.py)
- TriageAgent
  - description: "Clasifica consultas del usuario: GENERAL o SPECIFIC"
  - instruction (fragmento):
    """
    Eres un asistente que clasifica consultas de usuarios sobre iattraxia y la plataforma IAX.

    ...

    **Si es SPECIFIC**: Di algo como "DAcjame buscar esa informaciA3n en la documentaciA3n..."

    Sé conversacional y amigable.

    ** Importante**: No inventes respuestas. Si no sabes, di que no sabes. 
    Indicále al usuario que para preguntas específicas usaras la documentación oficial.
    Indicale al usuario cuando decidas ejecutar algunas tareas o delegar a otro agente.
    """
- QueryGeneratorAgent
  - description: "Genera 3 consultas de búsqueda diversas para maximizar cobertura"
  - instruction (fragmento):
    """
    ... Genera EXACTAMENTE 3 consultas de búsqueda diferentes ...
    Devuelve SOLO las 3 consultas en un array de strings, sin explicaciones ni texto adicional.
    """
- MultiRetrievalAgent
  - description: "Ejecuta búsquedas vectoriales con las consultas generadas"
  - instruction (fragmento):
    """
    ... USA la herramienta `vector_search` con CADA una de las 3 consultas ...
    Devuelve un Json con un array answers que contenga TODOS los chunks recuperados por cada pregunta y me metadata
    """
- SynthesizerAgent
  - description: "Genera respuesta final integrando información de múltiples búsquedas"
  - instruction (fragmento):
    """
    ... Identifica información complementaria y elimina redundancias ...
    - NO inventes información que no está en los chunks
    - Si múltiples chunks contradicen, menciona ambas perspectivas
    """
- tool `vector_search_tool` → `query_iax_documentation_rag` (ver docstring más abajo)


### Workana RAG (src/iax_agrag_agui_lab/agents/agrag/workana_rag_agent.py)
- WORKANA_PROMPT_SYNTH (constante, prompt base de rol/contexto, no directamente inyectado en agentes presentes):
  """
  # Role
  Eres asistente de Workana.

  # Tu Personalidad
  Se siempre muy amable y conciso. Solo saluda si te han saludado.

  # Tarea
  Asiste al usuario con sus preguntas. Cuentas con:
  - Los "datos del usuario", etiquetados como `<user></user>`
  - El help desk accesible a través del tool de búsqueda semántica `hd_retriever`
  - La descripción de estructura y operación, hechos condicionales, etc. que complementan el help desk y están explicados en este "## Contexto - Workana" ...

  ...

  **Importante:** Workana NO TIENE APP MÓVIL.
  ...
  """
- WorkanaTriageAgent
  - description: "Clasifica consultas del usuario: GENERAL o SPECIFIC (Workana)"
  - instruction (fragmento):
    """
    Eres un asistente que clasifica consultas de usuarios para el dominio de Workana.
    Si la consulta es GENERAL: responde de forma breve y amable.
    Si la consulta es SPECIFIC: indica "Déjame buscar esa información para ti..." y luego usa transfer_to_agent para llamar a 'RetrievalAgent'.
    """
- WorkanaQuestionGenerator
  - description: "Genera EXACTAMENTE 3 preguntas de clarificación relevantes para la consulta"
  - instruction (fragmento):
    """
    ... Genera EXACTAMENTE 3 preguntas de seguimiento ... Devuelve las 3 preguntas en un array de strings.
    """
- WorkanaSearchQueryGenerator
  - description: "Genera entre 3 y 5 consultas de búsqueda ..."
  - instruction (fragmento):
    """
    ... Genera entre 3 y 5 queries de búsqueda semántica ... Devuelve SOLO un array de strings ...
    """
- WorkanaMultiRetrievalAgent
  - description: "Ejecuta búsquedas con las queries generadas y recopila resultados"
  - instruction (fragmento):
    """
    ... Ejecuta hd_retriever para CADA query ... Devuelve un JSON con {"retrieved_chunks": [...], "by_query": { ... }}
    """
- WorkanaSynthesizerAgent
  - description: "Genera la respuesta final integrando las 3 preguntas y los resultados de búsqueda"
  - instruction (fragmento):
    """
    REGLAS:
    - Siempre comienza por plantear EXACTAMENTE las 3 preguntas generadas ...
    - Luego muestra un breve resumen ...
    - Finaliza con la sección "Fuentes:" ...
    - Si no sabes, di "No sé" o "No tengo esa información".
    """
- tool `hd_retriever` → `query_workana_documentation_rag` (ver docstring más abajo)


### Coordinator y Platform Specialist (src/iax_agrag_agui_lab/agents/coordinator_agent.py)
- PlatformSpecialist
  - description: "Expert in platform-specific queries."
  - instruction (fragmento):
    """
    Eres un experto en los agentes disponibles en la plataforma. 
    Puedes responder preguntas sobre las capacidades y funciones de cada agente.
    Para acceder a la información de cada agente, puedes usar la herramienta `list_agents` ...
    """
  - tool `list_agents` (FunctionTool a `get_platform_agents`) — devuelve nombre, descripción e instrucciones de cada agente.
- Coordinator
  - description (bloque):
    """
    # Role: Coordinador de Agentes
    Eres un asistente muy cordial a cargo de un labotorio de
    inteligencia artificial en el que se implementan otros multiples agentes
    a los puedes delegar trabajos.

    Tu única labor es identificar a quién delegar cada tarea.

    # Instrucciones:
    - Una vez que recibes el mensaje explica al usuario cual es tu lógica de la delegación.
    - Si no estás seguro de a quién delegar preguntale al agente {PlatformSpecialist}.

    # Importante
    - Siempre responde en el mismo idioma de la pregunta.
    - Responde en formato markdown.
    """


### Pizzería Loca (demo) (src/iax_agrag_agui_lab/agents/pizza_agent.py)
- Chef
  - description: "Crea pizzas personalizadas con ingredientes locos"
  - instruction (fragmento):
    """
    Eres un chef italiano creativo que inventa pizzas LOCAS.
    ... Responde SOLO con:
    [NOMBRE EN ITALIANO]
    Ingredientes: ...
    Preparación: [X] minutos
    """
- Delivery
  - description: "Calcula tiempo de entrega con excusas creativas"
  - instruction (fragmento):
    """
    ... La pizza que acabamos de preparar está en {pizza_created?}.
    ... Responde SOLO con:
    Entrega en [X] minutos
    Motivo: [excusa ...]
    """
- Cajero (agente principal)
  - description: "Cajero principal de la pizzería que coordina pedidos"
  - instruction (fragmento):
    """
    ... Tu personalidad es cálida, divertida y conversacional.
    FLUJO DE CONVERSACIÓN: ...
    - USA transfer_to_agent para llamar a 'KitchenPipeline'
    ... Importante: Siempre utiliza markdown ...
    """


### Herramientas RAG (docstrings)
- `query_iax_documentation_rag(question: str)` — src/iax_agrag_agui_lab/agents/agrag/query_iax_docs_tool.py
  """
  A tool that research the IAX ("la plataforma") documentation to find relevant
  information to answer the user's question.

  Params:
      question: The question to search for.

  Returns:
      A list of documents that contain relevant information.
  """
- `query_workana_documentation_rag(question: str)` — src/iax_agrag_agui_lab/agents/agrag/query_workana_docs_tool.py
  """
  A tool that research the Workana help desk to find relevant
  information to answer the user's question.

  Params:
      question: The question to search for.

  Returns:
      A list of documents that contain relevant information.
  """
- `create_adk_tavily_search_tool()` — src/iax_agrag_agui_lab/agents/tools/tavily_search_tool.py
  """
  Creates a Tavily search tool wrapped in a LangchainTool for ADK.
  """


## 3) Análisis de prompts

A continuación, un análisis breve y práctico por agente/herramienta.

- Hello Agent
  - Propósito: conversación amable de bienvenida y uso de una herramienta mínima.
  - Fortaleza: instrucciones claras, simple y accionable (llamar a `say_hello`).
  - Riesgos: sin manejo explícito de errores de formato del tool; prompt en inglés en repo mayormente español.
  - Mejora: indicar formato esperado al presentar la respuesta del tool; unificar idioma.

- Web Search Agent
  - Propósito: responder con búsqueda web (Tavily) como fuente primaria.
  - Fortaleza: conciso, directo; reduce al mínimo la ambigüedad.
  - Riesgos: no orienta a citar ni a validar alucinaciones; no controla longitud/resumen.
  - Mejora: exigir citar URLs o snippets, limitar longitud y sugerir verificación.

- Agentic RAG (simple)
  - Propósito: Triage → Retrieval → Synthesis con herramienta vectorial.
  - Fortaleza: pipeline claro; roles diferenciados; énfasis en no inventar en síntesis.
  - Riesgos: artefactos de codificación en el texto; criterios de “relevancia” no especificados; variables `{retrieved_chunks?}` sin formato concreto.
  - Mejora: definir esquema de chunks/metadata esperada, criterio de transferencia, y formato de “Fuentes”. Corregir encoding.

- Agentic RAG (multi‑query)
  - Propósito: Triage → generación de múltiples consultas → multi‑retrieval → síntesis.
  - Fortaleza: estrategia de diversidad de consultas; reglas para contradicciones; formato de salida esperado del retriever.
  - Riesgos: salida pedida como “Json con answers” sin especificación estricta (clave/estructura exacta), encoding defectuoso.
  - Mejora: definir JSON de contrato (keys y tipos), ejemplos concretos de entrada/salida, y límites de longitud.

- Workana RAG
  - Propósito: RAG específico de Workana con paso de clarificación antes de buscar.
  - Fortaleza: contexto de dominio; reglas de cortesía y restricciones; pipeline con clarificación → queries → búsqueda → síntesis.
  - Riesgos: el prompt WORKANA_PROMPT_SYNTH no está inyectado en los agentes; dependencia fuerte en tool `hd_retriever` sin formato de doc definido.
  - Mejora: integrar WORKANA_PROMPT_SYNTH como `system` del sintetizador o del triage; definir estructura de `retrieved_chunks` y política de citas.

- Coordinator / Platform Specialist
  - Propósito: orquestación y derivación a sub‑agentes; consulta a catálogo de agentes.
  - Fortaleza: instrucción de “explicar lógica de delegación” ayuda transparencia; herramienta `list_agents` como fuente.
  - Riesgos: sin criterios explícitos de mapeo entre intents y agentes; prompt con faltas/encoding que pueden confundir.
  - Mejora: añadir tabla de ruteo (reglas: dominios/keywords → agente), normalizar idioma, ejemplos de decisión.

- Pizzería Loca (demo)
  - Propósito: demostrar orquestación secuencial y paso de estado entre sub‑agentes.
  - Fortaleza: prompts con formato de respuesta muy específico (evita desviaciones).
  - Riesgos: encoding dañado; referencias a variables `{pizza_created?}`/`{delivery_info?}` dependen del runtime/estado.
  - Mejora: documentar claramente el contrato de estado y corregir encoding; agregar ejemplos de conversación.

- Herramientas RAG
  - Propósito: recuperación de documentos vía Pinecone y embeddings de OpenAI.
  - Fortaleza: docstrings describen objetivo y parámetros; fácil de envolver como `FunctionTool`.
  - Riesgos: docstrings no especifican el esquema de retorno real (en el código uno devuelve `List[Document]`, el otro tiene annotation `str` pero retorna documentos); posible inconsistencia.
  - Mejora: alinear type hints con retorno real, definir esquema de documento (campos clave, fuente) y ejemplos.


## Recomendaciones generales

- Normalizar idioma (ES) y corregir artefactos de codificación en todos los prompts.
- Definir contratos de datos entre agentes (claves esperadas como `{...}`) y herramientas (JSON, listas, metadatos).
- Añadir ejemplos de entrada/salida para cada `instruction` que imponga formatos de respuesta estrictos.
- Para RAG: exigir citas con formato consistente, listado de fuentes con URL/ID y evitar afirmaciones no soportadas.
- Para Coordinator: agregar reglas de ruteo explícitas y ejemplos de delegación.
- Para herramientas: incluir límites (p.ej., `max_docs`, `fields`), manejo de errores y trazabilidad de fuentes.

